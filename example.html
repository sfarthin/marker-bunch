<!DOCTYPE html>
<html lang="en">

<head>
	<title>Marker Group</title>

	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
	<link rel="stylesheet" href="bower_components/Leaflet.markercluster/dist/MarkerCluster.css" />
	<link rel="stylesheet" href="bower_components/Leaflet.markercluster/dist/MarkerCluster.Default.css" />
	<style>
		#map {
			width: 900px;
			height:600px;
		}
		
		.multiple-svg > div,.multiple-canvas > div {
			display: inline-block;
			position: relative;
			min-width: 150px;
			min-height: 150px;
		}
		
		.multiple-svg div svg, .multiple-canvas div canvas {
		 position: absolute;
		 top: 0px;
		 left:0px;
		}
	
	</style>
</head>

<body>
	
	
	<h1>Leaflet Plugin</h1>
	<div id="map"></div>
	
	
	<h1>Examples</h1>
	<div class="multiple-canvas"></div>
	
	<h1>SVG Examples</h1>
	<div class="multiple-svg"></div>
	
	<!--<script src="leaflet-src.js"></script>-->
	<script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
	<script src="bower_components/raphael/raphael-min.js"></script>
	
	<script src="Leaflet.markercluster/src/DistanceGrid.js"></script>
	<script src="Leaflet.markercluster/src/MarkerClusterGroup.js"></script>
	<script src="Leaflet.markercluster/src/MarkerCluster.js"></script>
	<script src="Leaflet.markercluster/src/MarkerCluster.QuickHull.js"></script>
	<script src="Leaflet.markercluster/src/MarkerCluster.Spiderfier.js"></script>
	
	<script src="markergroup.js"></script>
	<script src="leaflet.markergroup.js"></script>
	<script src="leaflet.groupicon.js"></script>
	
	<script>
		/**
		*
		* Marker Example
		*
		**/
		// var example1 = new MarkerGroup([
		// 	{
		// 		color: "90-#EB2B2A-#FA5B52",
		// 		icon: "disc"
		// 	}
		// ]);
		// 	
		// //document.querySelector(".example1").setAttrbute("src", example1); // cloneNode()
		// document.querySelector(".example1").appendChild(example1.svg());
		
		var generateMarkers = function(j) {
			var arr = [];
			for(var i = 0; i < j; i++) {
				if(Math.ceil((Math.random() * 10)) % 2) {
					arr.push({color: "90-#fdebb3:50-#ffc511:100", icon: "disc"});
				} else {
					arr.push({color: "90-#e06060:50-#EB2B2A:100", icon: "disc"});
				}
		
			} 
		
			return arr;
		
		}
			
		/**
		*
		* Canvas and SVG Examples
		*
		**/
			
		var containerSvg = document.querySelector(".multiple-svg"),
			containerCanvas = document.querySelector(".multiple-canvas");
		
		for(var i = 2; i < 40; i++) {
		
			var example 	= new MarkerGroup(generateMarkers(i));
		
			var canvas_div 	= document.createElement("div"),
				svg_div 	= document.createElement("div"),
				canvas 		= example.canvas()
				canvas_shadow= example.canvas_shadow();//,
				svg 		= example.svg(),
				svg_shadow  = example.svg_shadow();
		
			svg_shadow.style.position = "absolute";
			svg.style.position = "absolute";
			
			svg_div.appendChild(svg_shadow);
			svg_div.appendChild(svg);
			
			canvas_div.appendChild(canvas_shadow);
			canvas_div.appendChild(canvas);
		
			containerCanvas.appendChild(canvas_div);
			containerSvg.appendChild(svg_div);
		
		}
			
			
		/**
		*
		* Leaflet Plugin
		*
		**/
			
		var mapQuestTileLayer = L.tileLayer('http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png', {maxZoom: 18, attribution: '&copy; <a href="www.openstreetmap.org/copyright">OpenStreetMap</a>'}),
			latlng = L.latLng(50.5, 30.51);
		
		var map 		= L.map('map', {inertia: false, center: latlng, zoom: 15, layers: [mapQuestTileLayer]}),
			markerCluster = L.markerClusterGroup({
				maxClusterRadius: 8,
				showCoverageOnHover: false,
				iconCreateFunction: function(cluster) {
					if(!cluster._icon) {
						var children = cluster.getAllChildMarkers();
				
						var colors = children.map(function(marker) {
							return marker.options.icon.options.children[0];
						});
						
						return new MarkerGroup(colors, {color: "90-#45632e-#54B633", icon: "play"}).leafletIcon();
					}
				}
			});
		
		function getRandomLatLng(map) {
			var bounds = map.getBounds(),
				southWest = bounds.getSouthWest(),
				northEast = bounds.getNorthEast(),
				lngSpan = northEast.lng - southWest.lng,
				latSpan = northEast.lat - southWest.lat;
		
			return L.latLng(
					southWest.lat + latSpan * Math.random(),
					southWest.lng + lngSpan * Math.random());
		}
			
		function populate() {
			for (var i = 0; i < 200; i++) {
				var color;
				if(Math.ceil((Math.random() * 10)) % 2) {
					color = "90-#fdebb3-#ffc511";
				} else {
					color = "90-#e06060-#EB2B2A";
				}
				
				var m = L.marker(getRandomLatLng(map), {
					icon: new MarkerGroup([{color: color, icon: "disc"}], {color: "90-#45632e-#54B633", icon: "play"}).leafletIcon()
				});
		
				markerCluster.addLayer(m);
			}
			return false;
		}
			
		populate();
		map.addLayer(markerCluster);	

		
		
		// var example2 = MarkerGroup([
		// 	{color: "90-#EB2B2A-#FA5B52"},
		// 	{color: "90-#EB2B2A-#FA5B52"},
		// 	{color: "90-#EB2B2A-#FA5B52"},
		// 	{color: "90-#EB2B2A-#FA5B52"},
		// 	{color: "90-#EB2B2A-#FA5B52"},
		// 	{color: "90-#EB2B2A-#FA5B52"},
		// 	{color: "90-#EB2B2A-#FA5B52"}
		// ], 40);
		// 
		// document.querySelector(".example2").appendChild(example2.cloneNode());
		
	</script>
</body>